<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blog | Signs 2 Signs</title>
  <meta name="description" content="News, updates and articles from Signs 2 Signs." />

 <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&display=swap" rel="stylesheet">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-395583027"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-395583027');
  </script>

  <style>
    :root{
      --bg:#0b0b0c; --card:#121214; --muted:#9aa0a6; --text:#e8eaed; --brand:#4cc2ff; --border:#1f2023;
      --radius:18px; --max:1100px;
    }
    *,*::before,*::after{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; background:var(--bg); color:var(--text); }
    body{ font-family:'Manrope',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; line-height:1.6; }

    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; text-decoration-thickness:2px; text-underline-offset:3px; }

    header, footer{ background:transparent; }
    .container{ width:100%; max-width:var(--max); margin-inline:auto; padding:24px; }

    /* Page header spacer if header.html has its own layout */
    .page-head{ padding-top:8px; padding-bottom:12px; border-bottom:1px solid var(--border); margin-bottom:20px; }
    .page-head h1{ font-size:clamp(28px,3vw,40px); line-height:1.2; margin:0; font-weight:800; letter-spacing:-0.01em; }

    /* Featured */
    #featured{ display:grid; grid-template-columns: 1fr; gap:18px; background:var(--card); border:1px solid var(--border);
      border-radius:var(--radius); padding:16px; overflow:hidden; }
    #featured img{ width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:12px; display:block; }
    #featured .featured-content{ display:flex; flex-direction:column; gap:8px; }
    #featured h2{ font-size:clamp(22px,2.4vw,30px); margin:0; font-weight:800; letter-spacing:-0.01em; }
    #featured p{ margin:0; color:var(--muted); }
    #featured a{ align-self:flex-start; margin-top:2px; font-weight:700; background:linear-gradient(90deg,var(--brand),#6ef3ff);
      color:#001018; padding:10px 14px; border-radius:999px; text-decoration:none; }
    #featured a:hover{ opacity:.9; text-decoration:none; }

    @media (min-width:820px){
      #featured{ grid-template-columns: 1.2fr 1fr; padding:18px; }
    }

    /* Grid of posts */
    .grid{ display:grid; gap:16px; grid-template-columns: 1fr; margin-top:20px; }
    @media (min-width:640px){ .grid{ grid-template-columns: repeat(2,1fr); } }
    @media (min-width:980px){ .grid{ grid-template-columns: repeat(3,1fr); } }

    .card{ display:flex; flex-direction:column; gap:8px; background:var(--card); border:1px solid var(--border);
      border-radius:16px; padding:12px; transition:transform .15s ease, border-color .15s ease; }
    .card:hover{ transform:translateY(-2px); border-color:#2a2b30; text-decoration:none; }
    .card .thumb{ width:100%; aspect-ratio:16/10; object-fit:cover; border-radius:12px; display:block; background:#0e0f10; }
    .card .title{ font-weight:800; letter-spacing:-0.01em; line-height:1.3; font-size:1.05rem; }
    .card .desc{ margin:0; color:var(--muted); font-size:.95rem; }

    /* Archive */
    .archive-wrap{ margin-top:28px; }
    .archive-wrap h3{ margin:0 0 10px; font-size:1.2rem; font-weight:800; letter-spacing:-0.01em; }
    #archive details{ background:var(--card); border:1px solid var(--border); border-radius:14px; padding:10px 12px; margin-bottom:10px; }
    #archive summary{ cursor:pointer; font-weight:800; list-style:none; }
    #archive summary::-webkit-details-marker{ display:none; }
    #archive .month{ padding:6px 0 8px; }
    #archive .month h4{ margin:8px 0 4px; font-size:1rem; font-weight:700; color:var(--muted); }
    .archive-list{ list-style:none; padding:0; margin:0; columns:1; column-gap:24px; }
    .archive-list li{ break-inside:avoid; padding:4px 0; }
    .archive-list a{ color:#d5e3ff; text-decoration:none; }
    .archive-list a:hover{ text-decoration:underline; }

    .empty{ color:var(--muted); background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; }

    /* Footer spacing */
    .footpad{ height:12px; }
  </style>
</head>
<body>
  <header id="header"></header>

  <main class="container" id="main">
    <div class="page-head">
      <h1>Blog</h1>
    </div>

    <!-- Featured -->
    <section id="featured" aria-label="Featured post"></section>

    <!-- Cards -->
    <section aria-label="Recent posts">
      <div id="posts" class="grid"></div>
    </section>

    <!-- Archive -->
    <section class="archive-wrap" aria-label="Archive">
      <h3>Archive</h3>
      <div id="archive"></div>
    </section>

    <div class="footpad"></div>
  </main>

  <footer id="footer"></footer>

  <!-- Blog logic -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // Supabase (anon) — provided by you
    const SUPABASE_URL = "https://ketluxsokzvlqozcdwxo.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtldGx1eHNva3p2bHFvemNkd3hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzNjAzOTIsImV4cCI6MjA3MDkzNjM5Mn0.NCPCOXJ4vD1PYb_sBgoyA6lSvkiRpb8IlA4X8XnltUs";
    export const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    /* elements */
    const postsEl    = document.getElementById("posts");
    const archiveEl  = document.getElementById("archive");
    const featuredEl = document.getElementById("featured");

    /* includes */
    async function includePartials({ headerSel="#header", footerSel="#footer" } = {}) {
      try {
        const [header, footer] = await Promise.all([
          fetch("/header.html").then(r => r.ok ? r.text() : ""),
          fetch("/footer.html").then(r => r.ok ? r.text() : "")
        ]);
        const h = document.querySelector(headerSel), f = document.querySelector(footerSel);
        if (h) h.innerHTML = header;
        if (f) f.innerHTML = footer;
      } catch (e) { console.error(e); }
    }

    /* data */
    async function fetchFeaturedPost(){
      const { data, error } = await supabase
        .from("posts")
        .select("id,slug,title,description,main_image_url,published_at,created_at,featured")
        .eq("featured", true)
        .order("published_at", { ascending:false, nullsFirst:false })
        .order("created_at", { ascending:false, nullsFirst:false })
        .limit(1);
      return { data: data?.[0] ?? null, error };
    }

    async function fetchAllPosts(){
      const { data, error } = await supabase
        .from("posts")
        .select("id,slug,title,description,main_image_url,published_at,created_at,featured")
        .order("published_at", { ascending:false, nullsFirst:false })
        .order("created_at", { ascending:false, nullsFirst:false })
        .order("id", { ascending:false });
      return { data, error };
    }

    /* helpers */
    const linkFor = p => `/blog/${encodeURIComponent(p.slug || String(p.id))}`;

    function groupByYearMonth(posts){
      const buckets = new Map();
      for(const p of posts){
        const d  = p.published_at || p.created_at || null;
        const dt = d ? new Date(d) : null;
        const year  = dt ? dt.getFullYear() : "Unknown";
        const month = dt ? dt.toLocaleString("en-GB",{ month:"long" }) : "Unsorted";
        if(!buckets.has(year)) buckets.set(year,new Map());
        const m = buckets.get(year);
        if(!m.has(month)) m.set(month,[]);
        m.get(month).push(p);
      }
      // Sort years desc
      return new Map([...buckets.entries()].sort((a,b)=>(b[0]+"").localeCompare(a[0]+"")));
    }

    function buildArchive(posts){
      const grouped = groupByYearMonth(posts);
      archiveEl.innerHTML = "";
      for(const [year, months] of grouped){
        const det = document.createElement("details"); det.open = true;
        const sum = document.createElement("summary"); sum.textContent = year; det.appendChild(sum);

        const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
        const ordered = monthNames.filter(m=>months.has(m));
        if(months.has("Unsorted")) ordered.push("Unsorted");

        for(const m of ordered){
          const wrap = document.createElement("div"); wrap.className="month";
          const h4 = document.createElement("h4"); h4.textContent = m; wrap.appendChild(h4);
          const ul = document.createElement("ul"); ul.className="archive-list";
          for(const p of months.get(m)){
            const li = document.createElement("li");
            const a  = document.createElement("a"); a.href = linkFor(p); a.textContent = p.title || "Untitled";
            li.appendChild(a); ul.appendChild(li);
          }
          wrap.appendChild(ul); det.appendChild(wrap);
        }
        archiveEl.appendChild(det);
      }
    }

    /* render */
    async function render(){
      postsEl.textContent = "Loading…";
      featuredEl.innerHTML = "";

      const [{ data: featured }, { data: all, error }] = await Promise.all([ fetchFeaturedPost(), fetchAllPosts() ]);

      if (error){
        postsEl.textContent = "Error loading posts.";
        archiveEl.innerHTML = "";
        featuredEl.innerHTML = "";
        return;
      }

      if (!all || all.length === 0){
        postsEl.innerHTML = `<p class="empty">No posts yet.</p>`;
        archiveEl.innerHTML = `<p class="empty">Nothing to archive… yet.</p>`;
        featuredEl.innerHTML = "";
        return;
      }

      const hero = featured || all[0];
      const heroImg = hero.main_image_url ? `<img src="${hero.main_image_url}" alt="" loading="eager" fetchpriority="high">` : "";

      featuredEl.innerHTML = `
        ${heroImg}
        <div class="featured-content">
          <h2>${hero.title ?? "Untitled"}</h2>
          ${hero.description ? `<p>${hero.description}</p>` : ""}
          <a href="${linkFor(hero)}" aria-label="Read full post ${hero.title ?? ''}">Read full post →</a>
        </div>
      `;

      buildArchive(all);

      const heroKey = hero.slug ?? hero.id;
      const rest = all.filter(p => (p.slug ?? p.id) !== heroKey);
      postsEl.innerHTML = "";

      for(const p of rest){
        const a = document.createElement("a");
        a.className = "card";
        a.href = linkFor(p);
        a.innerHTML = `
          ${p.main_image_url ? `<img class="thumb" src="${p.main_image_url}" alt="" loading="lazy">` : ""}
          <div class="title">${p.title ?? "Untitled"}</div>
          ${p.description ? `<p class="desc">${p.description}</p>` : ""}
        `;
        postsEl.appendChild(a);
      }
    }

    includePartials();
    render();
  </script>
</body>
</html>
